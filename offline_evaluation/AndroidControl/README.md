# AndroidControl Evaluation Pipeline

This folder contains the evaluation pipeline for the **AndroidControl** benchmark. Below is a detailed description of the scripts, their usage, and the order in which they should be executed.

You can download the AndroidControl test split images folder from [GoogleDrive](https://drive.google.com/file/d/1HcqXk17C1oUGUmDoZZXHkS-n41lxXDQ6/view?usp=sharing). The **subfolder names** represent `episode_id`, and each image is named `screenshot_{step}.png`.

**1. `sample.py`**

Sample a subset of data from the whole dataset.

```bash
python sample.py --input_file <path_to_input_file> --output_file <path_to_output_file> -n <num_samples>
```

The `input_file` was generated by processing the original AndroidControl data according to the rules specified in the paper. You can download it from [Google Drive](https://drive.google.com/file/d/1iylEHPoz2hwmuKDMND7Lrsn331SueZ4F/view?usp=drive_link). As in the paper, we use n=500, and the samples are in `data/500_steps`.

**2. `gpt_plan.py`**

Generate plan files using GPT models.

```bash
export OPENAI_API_KEY="Your OpenAI API Key"
python gpt_plan.py --model <gpt_model> --input_file <sample_jsonl> --output_file <plan_jsonl> --screenshot_dir <screenshot_dir> --level <task_level>
```

- `gpt_model` can be "gpt-4o" or "gpt-4-turbo"
- `level` can be "high" or "low"

The GPT-4o-generated plan files we use are in `data/plan_gpt-4o_{level}.jsonl`.

**3. `extract_grounding_query.py`**

Extract grounding queries from the plan files.

```bash
python extract_grounding_query.py --sample_file <sample_jsonl> --input_file <plan_jsonl> --output_file <query_jsonl> --screenshot_dir <screenshot_dir>
```

The queries extracted from GPT-4o plan files are in `data/query_gpt-4o_{level}.jsonl`.

**4. Grounding Model Inference**

Perform grounding model inference using the query file generated in the previous step. 

**5. `eval.py`**

Evaluate the Step Accuracy and Grounding Accuracy based on plan and grounding results. If you want to test with UGround-V1, you can use the scripts provided in the `grounding` folder.

```bash
python eval.py --sample_file <sample_jsonl> --plan_file <plan_jsonl> --ans_file <grounding_answer_jsonl>
```

